# OpenAI GPT Integration Setup Guide

## ðŸš€ Quick Setup Checklist

### âœ… Step 1: Environment Configuration
Your `.env.local` file is already configured with the basic structure. You need to update these specific values:

```bash
# Edit .env.local and update these values:
OPENAI_API_KEY=sk-your-actual-openai-key-here
OPENAI_ASSISTANT_ID=asst_your-actual-assistant-id-here
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### âœ… Step 2: Database Migration
Run this SQL in your Supabase dashboard:

```sql
-- Copy and paste the entire content of:
-- supabase/migrations/20241220000000_add_aiv_tables.sql
```

### âœ… Step 3: Create OpenAI Assistant
1. Go to [OpenAI Platform](https://platform.openai.com/assistants)
2. Click "Create Assistant"
3. Configure with these settings:
   - **Name**: DealershipAI AIV Calculator
   - **Model**: gpt-4-turbo-preview
   - **Instructions**: 
   ```
   You are DealershipAI, an expert in automotive AI visibility analysis. 
   
   When computing AIV metrics, always respond with valid JSON containing:
   - aiv: Overall AI Visibility Score (0-100)
   - ati: Answer Engine Intelligence Score (0-100) 
   - crs: Citation Relevance Score (0-100)
   - elasticity_usd_per_pt: Revenue impact per AIV point
   - r2: Statistical confidence coefficient (0-1)
   - recommendations: Array of 3 actionable insights
   
   Example response:
   {
     "aiv": 82,
     "ati": 78,
     "crs": 85,
     "elasticity_usd_per_pt": 156.30,
     "r2": 0.87,
     "recommendations": [
       "Improve local SEO citations",
       "Optimize for voice search queries", 
       "Enhance review response rate"
     ]
   }
   ```
4. Copy the Assistant ID and update your `.env.local`

### âœ… Step 4: Test Integration
Run these test commands:

```bash
# Test 1: GPT Proxy
curl -X POST http://localhost:3000/api/gpt-proxy \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Test AIV computation for demo dealer", "dealerId": "demo-dealer"}'

# Test 2: AIV Metrics
curl http://localhost:3000/api/aiv-metrics?dealerId=demo-dealer

# Test 3: Elasticity Recompute
curl -X POST http://localhost:3000/api/elasticity/recompute \
  -H "Content-Type: application/json" \
  -d '{"dealerId": "demo-dealer"}'
```

### âœ… Step 5: Start Development Server
```bash
npm run dev
```

Then visit: http://localhost:3000/dashboard

## ðŸ”§ Troubleshooting

### Common Issues:

1. **"OpenAI API key not configured"**
   - Check `.env.local` has correct `OPENAI_API_KEY`
   - Restart dev server: `npm run dev`

2. **"Access denied to this dealer"**
   - Run the database migration first
   - Check `dealer_access` table has your user

3. **"Assistant run failed"**
   - Verify `OPENAI_ASSISTANT_ID` is correct
   - Check Assistant is active in OpenAI dashboard

4. **"No AIV data available"**
   - Click "Compute Initial AIV" button in dashboard
   - Check database has sample data

## ðŸ“Š What You'll See

Once configured, the dashboard will show:

- **AIV Metrics Panel** with real-time scores
- **Elasticity visualization** showing revenue impact
- **12-week trend charts** for historical data
- **AI recommendations** generated by GPT
- **Manual recompute buttons** for updates

## ðŸŽ¯ Success Indicators

- âœ… AIV Metrics Panel loads without errors
- âœ… GPT proxy responds with valid JSON
- âœ… Database stores metrics correctly
- âœ… Dashboard shows real-time updates
- âœ… No API key exposure in browser

## ðŸš€ Production Deployment

When ready for production:

1. Update environment variables in Vercel
2. Run database migration in production Supabase
3. Test all endpoints in production
4. Monitor API usage and costs

## ðŸ“ž Support

If you encounter issues:
1. Check the troubleshooting section above
2. Review browser console for errors
3. Check Supabase logs for database issues
4. Verify OpenAI API usage in dashboard

---

**Ready to proceed?** Run the test commands above to verify everything works!
