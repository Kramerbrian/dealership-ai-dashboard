export type Pulse={id:string;title:string;diagnosis:string;prescription:string;impactMonthlyUSD:number;etaSeconds:number;confidenceScore:number;recencyMinutes:number;kind:'reviews'|'ugc'};export async function reviewsToPulses(params:{placeId?:string;domain?:string}):Promise<Pulse[]>{try{const q=new URLSearchParams();if(params.placeId)q.set('placeId',params.placeId);if(params.domain)q.set('domain',params.domain);const res=await fetch(`/api/reviews/summary?${q.toString()}`,{cache:'no-store'});if(!res.ok)return[];const r=await res.json();const pulses:Pulse[]=[];if(r.replyLatencyHours>48||r.recentUnanswered>5)pulses.push({id:'reviews_latency',title:`${r.recentUnanswered} unanswered•${r.replyLatencyHours}h`,diagnosis:`Slow replies erode Trust. Rate ${r.replyRatePct}%`,prescription:'Batch-respond; enable alerts; 10am schedule.',impactMonthlyUSD:3100,etaSeconds:120,confidenceScore:0.78,recencyMinutes:20,kind:'reviews'});if(r.last30New<40&&r.avgRating<4.4)pulses.push({id:'reviews_cadence',title:'Low review cadence caps visibility',diagnosis:`${r.last30New} reviews/30d at ${r.avgRating.toFixed(1)}★`,prescription:'SMS ask post-service; target +2/day; QR.',impactMonthlyUSD:1500,etaSeconds:90,confidenceScore:0.65,recencyMinutes:20,kind:'ugc'});return pulses}catch{return[]}}